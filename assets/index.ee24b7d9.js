import{g as d,l as F,W as G,o as L,L as t,d as l,S as J,X as y,q as S,i as M,p as T}from"./index.56433eb2.js";import{B as I}from"./Button.8c3124fe.js";import{T as D}from"./TextField.73c23d88.js";import{u as j}from"./solid.4b4bed56.js";import{P as O,S as V,R as W}from"./index.054ff1c8.js";import{v as X}from"./getDeviceId.e8f3946a.js";import"./isHostComponent.9ebad583.js";const z=S('<p>Peer "<!>" [changed x<!>], clk <!>, connectionState <!>, singalingState </p>'),A=S("<p>Loading participants...</p>"),H=S("<div><p>User: </p><br><br><p>User-Device Id: </p><div><p>Participants:</p><ul></ul></div><div><p>Peers:</p><ul></ul></div></div>"),K=S("<li>User Id: </li>"),Q=S("<li>No peers.</li>"),Y=S("<li></li>"),Z=i=>{const[h,s]=d(O.unknown),[b,R]=d("stable"),[f,o]=d(0),C=n=>{s(n),o(g=>g+1)},u=()=>{R(i.peer.connection.signalingState),o(n=>n+1)};return M(()=>{s(i.peer.connectionState)}),T(()=>{i.peer.bus.on("connectionstatechange",C),i.peer.connection.addEventListener("signalingstatechange",u)}),L(()=>{i.peer.bus.detach("connectionstatechange",C),i.peer.connection.removeEventListener("signalingstatechange",u)}),(()=>{const n=z.cloneNode(!0),g=n.firstChild,_=g.nextSibling,$=_.nextSibling,v=$.nextSibling,w=v.nextSibling,x=w.nextSibling,e=x.nextSibling,c=e.nextSibling;return c.nextSibling,t(n,()=>i.peer.userDeviceId,_),t(n,f,v),t(n,()=>i.peer.clk.toString(),x),t(n,h,c),t(n,b,null),n})()},le=()=>{const[i,h]=d(""),[s,b]=d(""),[R,f]=d([],{equals:!1}),o=j(),C=F(),[u,n]=d(),[g,_]=G(()=>X(s())?o.getParticipants(s()):[]),$=async e=>{await o.isJoinedRoomById(e)||await o.joinRoomById(e),_.refetch();const c=V.ofRoom(o.supabase,e,o.getUserDeviceId()),a=new W(o.getUserDeviceId(),c,e);a.bus.on("addpeer",()=>{f(a.peers)}),a.bus.on("removepeer",m=>{m.disconnect(),f(a.peers)}),await a.broadcastPeerList(),n(a)},v=async()=>{const e=await o.createRoom(i());b(e.id),h(e.name),await $(e.id)},w=async()=>{const e=await o.findRoomById(s());e?(b(e.id),h(e.name),await $(e.id)):alert(`Could not found room ${s()}`)};L(async()=>{const e=u();e&&(await e.stop(),n())});const x=()=>{const e=u();if(e)return e.userDeviceId};return(()=>{const e=H.cloneNode(!0),c=e.firstChild;c.firstChild;const a=c.nextSibling,m=a.nextSibling,N=m.nextSibling;N.firstChild;const P=N.nextSibling,k=P.firstChild,B=k.nextSibling,U=P.nextSibling,E=U.firstChild,q=E.nextSibling;return t(c,()=>JSON.stringify(C.user(),void 0,2),null),t(e,l(D,{variant:"standard",get value(){return i()},label:"Room Name",onChange:r=>h(r.target.value)}),a),t(e,l(I,{onClick:v,children:"Create New Room"}),a),t(e,l(D,{variant:"standard",get value(){return s()},label:"Room ID",onChange:r=>b(r.target.value)}),m),t(e,l(I,{onClick:w,children:"Enter Room"}),m),t(e,l(I,{onClick:()=>{const r=u();r&&r.broadcastPeerList()},children:"Sync Peer List"}),m),t(N,()=>x()||"unknown",null),t(P,l(J,{get when(){return g.loading},get children(){return A.cloneNode(!0)}}),k),t(B,l(y,{get each(){return g()},children:r=>(()=>{const p=K.cloneNode(!0);return p.firstChild,t(p,()=>r.user_id,null),p})()})),t(q,l(y,{get each(){return R()},get fallback(){return Q.cloneNode(!0)},children:r=>(()=>{const p=Y.cloneNode(!0);return t(p,l(Z,{peer:r})),p})()})),e})()};export{le as default};
//# sourceMappingURL=index.ee24b7d9.js.map
