import{g as d,n as F,Y as G,o as B,N as t,d as l,S as J,Z as y,l as S,i as M,q as T}from"./index.0b0797f8.js";import{B as I}from"./Button.c1c2aac3.js";import{T as D}from"./TextField.71eb3b91.js";import{u as j}from"./solid.a5959298.js";import{P as O,S as V,R as Y}from"./index.76b42fb2.js";import{v as Z}from"./getDeviceId.e8f3946a.js";import"./isHostComponent.9ebad583.js";const z=S('<p>Peer "<!>" [changed x<!>], clk <!>, connectionState <!>, singalingState </p>'),A=S("<p>Loading participants...</p>"),H=S("<div><p>User: </p><br><br><p>User-Device Id: </p><div><p>Participants:</p><ul></ul></div><div><p>Peers:</p><ul></ul></div></div>"),K=S("<li>User Id: </li>"),Q=S("<li>No peers.</li>"),W=S("<li></li>"),X=i=>{const[h,s]=d(O.unknown),[b,R]=d("stable"),[f,o]=d(0),C=n=>{s(n),o(g=>g+1)},u=()=>{R(i.peer.connection.signalingState),o(n=>n+1)};return M(()=>{s(i.peer.connectionState)}),T(()=>{i.peer.bus.on("connectionstatechange",C),i.peer.connection.addEventListener("signalingstatechange",u)}),B(()=>{i.peer.bus.detach("connectionstatechange",C),i.peer.connection.removeEventListener("signalingstatechange",u)}),(()=>{const n=z.cloneNode(!0),g=n.firstChild,_=g.nextSibling,$=_.nextSibling,v=$.nextSibling,w=v.nextSibling,x=w.nextSibling,e=x.nextSibling,c=e.nextSibling;return c.nextSibling,t(n,()=>i.peer.userDeviceId,_),t(n,f,v),t(n,()=>i.peer.clk.toString(),x),t(n,h,c),t(n,b,null),n})()},le=()=>{const[i,h]=d(""),[s,b]=d(""),[R,f]=d([],{equals:!1}),o=j(),C=F(),[u,n]=d(),[g,_]=G(()=>Z(s())?o.getParticipants(s()):[]),$=async e=>{await o.isJoinedRoomById(e)||await o.joinRoomById(e),_.refetch();const c=V.ofRoom(o.supabase,e,o.getUserDeviceId()),r=new Y(o.getUserDeviceId(),c,e);r.bus.on("addpeer",()=>{f(r.peers)}),r.bus.on("removepeer",m=>{m.disconnect(),f(r.peers)}),await r.broadcastPeerList(),n(r)},v=async()=>{const e=await o.createRoom(i());b(e.id),h(e.name),await $(e.id)},w=async()=>{const e=await o.findRoomById(s());e?(b(e.id),h(e.name),await $(e.id)):alert(`Could not found room ${s()}`)};B(()=>{const e=u();e&&(n(),e.stop())});const x=()=>{const e=u();if(e)return e.userDeviceId};return(()=>{const e=H.cloneNode(!0),c=e.firstChild;c.firstChild;const r=c.nextSibling,m=r.nextSibling,N=m.nextSibling;N.firstChild;const P=N.nextSibling,k=P.firstChild,L=k.nextSibling,U=P.nextSibling,E=U.firstChild,q=E.nextSibling;return t(c,()=>JSON.stringify(C.user(),void 0,2),null),t(e,l(D,{variant:"standard",get value(){return i()},label:"Room Name",onChange:a=>h(a.target.value)}),r),t(e,l(I,{onClick:v,children:"Create New Room"}),r),t(e,l(D,{variant:"standard",get value(){return s()},label:"Room ID",onChange:a=>b(a.target.value)}),m),t(e,l(I,{onClick:w,children:"Enter Room"}),m),t(e,l(I,{onClick:()=>{const a=u();a&&a.broadcastPeerList()},children:"Sync Peer List"}),m),t(N,()=>x()||"unknown",null),t(P,l(J,{get when(){return g.loading},get children(){return A.cloneNode(!0)}}),k),t(L,l(y,{get each(){return g()},children:a=>(()=>{const p=K.cloneNode(!0);return p.firstChild,t(p,()=>a.user_id,null),p})()})),t(q,l(y,{get each(){return R()},get fallback(){return Q.cloneNode(!0)},children:a=>(()=>{const p=W.cloneNode(!0);return t(p,l(X,{peer:a})),p})()})),e})()};export{le as default};
//# sourceMappingURL=index.2c7a0208.js.map
