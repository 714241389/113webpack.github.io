import{l as c,_ as oe,u as $,g as v,Y as P,q as re,i as w,o as ie,d as t,S as D,e as L}from"./index.0b0797f8.js";import{A as se,P as ae}from"./Popover.7a0330e4.js";import{B as z,b as ce}from"./Button.c1c2aac3.js";import{c as M,e as le,I as de,T as a,C as B,a as S,M as E,L as H,b as I}from"./IconButton.98bd67c8.js";import{u as ue}from"./solid.a5959298.js";import{D as u,a as ge,b as he}from"./index.d4193fce.js";import{F as d,S as me,R as fe}from"./index.76b42fb2.js";import{T as pe}from"./index.3fcd7a1c.js";import"./isHostComponent.9ebad583.js";import"./getDeviceId.e8f3946a.js";const ve=c('<svg><path d="M0 0h24v24H0z" fill="none"></path></svg>',4,!0),we=c('<svg><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>',4,!0);var xe=M(()=>[ve.cloneNode(!0),we.cloneNode(!0)],"Close");const Ce=c('<svg><path d="M0 0h24v24H0z" fill="none"></path></svg>',4,!0),De=c('<svg><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"></path></svg>',4,!0);var Ie=M(()=>[Ce.cloneNode(!0),De.cloneNode(!0)],"Person");const Me=c('<svg><path d="M0 0h24v24H0z" fill="none"></path></svg>',4,!0),_e=c('<svg><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg>',4,!0);var ze=M(()=>[Me.cloneNode(!0),_e.cloneNode(!0)],"Link");const be=c('<svg><path d="M17 7h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1 0 1.43-.98 2.63-2.31 2.98l1.46 1.46C20.88 15.61 22 13.95 22 12c0-2.76-2.24-5-5-5zm-1 4h-2.19l2 2H16zM2 4.27l3.11 3.11C3.29 8.12 2 9.91 2 12c0 2.76 2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1 0-1.59 1.21-2.9 2.76-3.07L8.73 11H8v2h2.73L13 15.27V17h1.73l4.01 4L20 19.74 3.27 3 2 4.27z"></path></svg>',4,!0),Te=c('<svg><path d="M0 24V0" fill="none"></path></svg>',4,!0);var Ne=M(()=>[be.cloneNode(!0),Te.cloneNode(!0)],"LinkOff");const Re=3e3,Fe=3e3,C=302;var s;(function(n){n[n.Unknown=0]="Unknown",n[n.Found=1]="Found",n[n.Joined=2]="Joined",n[n.NotFound=3]="NotFound"})(s||(s={}));const Ue=n=>t(E,{get open(){return n.open},get children(){return t(B,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",maxWidth:"650px"},get children(){return t(S,{sx:{textAlign:"center"},get children(){return t(a,{children:"Communicating with Magicbroad..."})}})}})}}),ye=n=>{const r=$();return t(E,{get open(){return n.open},get children(){return t(B,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",maxWidth:"650px"},get children(){return[t(S,{get children(){return[t(a,{variant:"h6",children:"The Room is Missing"}),t(a,{children:"We could not found the room you want. The owner might have been deleted the room."})]}}),t(H,{get children(){return t(I,{sx:{paddingLeft:0,paddingRight:0},get children(){return t(z,{variant:"text",sx:{width:"100%",justifyContent:"flex-end"},onClick:()=>r("/"),get children(){return t(a,{sx:{marginRight:"20px"},component:"div",children:"Go to the Home Page"})}})}})}})]}})}})},ke=n=>{const r=()=>{const[l,h]=n.position;return{left:l,top:h}},g={cursor:"pointer"};return t(ae,{get open(){return typeof n.position!="undefined"},anchorReference:"anchorPosition",get anchorPosition(){return r()},onClose:()=>n.onClose(),get children(){return t(H,{get children(){return[t(I,{sx:g,onClick:()=>n.onChangingDrawingTool(u.pen),get children(){return[t(a,{children:"Pen"}),t(D,{get when(){return n.currentDrawingTool===u.pen},children:"*"})]}}),t(I,{sx:g,onClick:()=>n.onChangingDrawingTool(u.erase),get children(){return[t(a,{children:"Erase"}),t(D,{get when(){return n.currentDrawingTool===u.erase},children:"*"})]}}),t(I,{sx:g,onClick:()=>n.onChangingDrawingTool(u.hand),get children(){return[t(a,{children:"Move"}),t(D,{get when(){return n.currentDrawingTool===u.hand},children:"*"})]}})]}})}})},Ge=()=>{const n=oe(),r=ue(),g=$(),[l,h]=v(s.Unknown),[m,O]=v(),[b,A]=v(u.pen),[W,T]=v(),[f,G]=v(),x=new ge("black",20),_=new Map,[N,J]=P(()=>{const e=m();return e?r.getParticipants(e.id):[]}),[V,R]=P(()=>{const e=m();return e?r.getRoomOpts(e.id).then(async o=>o.size_x&&o.size_y?o:(await r.setRoomOpts(e.id,{size_x:Re,size_y:Fe}),await r.getRoomOpts(e.id))):Promise.resolve(void 0)}),Y=e=>{T([e.pageX,e.pageY])},F=e=>{const o=_.get(e);return typeof o=="undefined"?(_.set(e,[]),F(e)):o},j=e=>{if(e.message.length>=1){const o=e.message[0];if(o.isUInt()){const i=o.toUInt();if(console.log(i),i===C&&e.message.length>=5){const[,p,Q,ee,te]=e.message,ne={x:p.toUInt(),y:Q.toUInt(),lineWidth:ee.toUInt(),color:te.toString()},k=F(e.srcUserDeviceId);k.push(ne),x.draw(k)}else i===C&&e.message.length>=2&&_.set(e.srcUserDeviceId,[])}}},U=e=>{const o=e[e.length-1],i=f();i&&i.broadcast([d.fromUInt(C,!0),d.fromUInt(o.x,!0),d.fromUInt(o.y,!0),d.fromUInt(o.lineWidth,!0),d.fromString(o.color,!1)],!0)},X=()=>{const e=f();e&&e.broadcast([d.fromUInt(C,!0),d.zero(0)],!0)},y=e=>{const o=me.ofRoom(r.supabase,e,r.getUserDeviceId()),i=new fe(r.getUserDeviceId(),o,e);return i.bus.on("addpeer",p=>{console.log("addpeer",p)}),i.bus.on("removepeer",p=>{p.disconnect()}),i.bus.on("data",j),i};re(async()=>{const e=await r.findRoomById(n.id);e?(O(e),h(s.Found),await r.isJoinedRoomById(e.id)||await r.joinRoomById(e.id),h(s.Joined),R.refetch()):h(s.NotFound)}),w(()=>{l()===s.Joined&&J.refetch()}),w(()=>{x.setTool(b())}),w(()=>{const e=V();e?e.size_x&&e.size_y&&x.setOffscreenSize([e.size_x,e.size_y]):R.refetch()}),w(()=>{const e=m();e&&G(o=>o&&o.roomId!==e.id?(o.stop(),y(e.id)):typeof o=="undefined"?y(e.id):o)}),w(()=>{const e=f();e&&e.broadcastPeerList()}),ie(()=>{const e=f();e&&e.stop()});const Z=()=>l()===s.Unknown||l()===s.Found,q=()=>l()===s.NotFound,K=()=>{var e;return l()===s.Found?"Magicbroad Room":`Magicbroad: "${(e=m())==null?void 0:e.name}"`};return[t(pe,{get title(){return K()}}),t(Ue,{get open(){return Z()}}),t(ye,{get open(){return q()}}),t(ke,{get position(){return W()},onClose:()=>T(),get currentDrawingTool(){return b()},onChangingDrawingTool:e=>A(e)}),t(ce,{sx:{flexGrow:1},get children(){return t(se,{position:"absolute",color:"transparent",get children(){return t(le,{get children(){return[t(de,{size:"large",edge:"start",color:"inherit","aria-label":"close",sx:{mr:2},onClick:()=>g("/"),get children(){return t(xe,{})}}),t(a,{variant:"h6",component:"div",sx:{flexGrow:1},children:()=>{var e;return(e=m())==null?void 0:e.name}}),t(z,{size:"large",color:"inherit",variant:"text",get children(){return t(D,{get when(){return f()},get fallback(){return t(Ne,{})},get children(){return t(ze,{})}})}}),t(z,{size:"large",color:"inherit",variant:"text",get children(){return[t(Ie,{}),L(()=>{var e;return L(()=>!!N.loading,!0)()?"...":(e=N())==null?void 0:e.length})]}})]}})}})}}),t(he,{ctl:x,onContextMenu:Y,onStart:U,onDrawing:U,onEnd:X})]};export{Ge as default};
//# sourceMappingURL=index.3575b7ca.js.map
